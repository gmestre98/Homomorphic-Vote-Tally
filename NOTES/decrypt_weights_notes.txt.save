##############################################################################



  // Setting the parameters for the encryption
  EncryptionParameters parms(scheme_type::BFV);
  size_t poly_modulus_degree = 4096;
  parms.set_poly_modulus_degree(poly_modulus_degree);
  parms.set_coeff_modulus(CoeffModulus::BFVDefault(poly_modulus_degree));
  parms.set_plain_modulus(PlainModulus::Batching(poly_modulus_degree, 20));
  auto context = SEALContext::Create(parms);
  int bananas[3];

  // Getting the public key from the corresponding file
  ifstream pkey;
  pkey.open("../Proj/Keys/election_public_key.txt", ios::binary);
  PublicKey election_public_key;
  election_public_key.load(context, pkey);
  pkey.close();

  // APAGAR DEPOIS ATÃ‰ AO APAGAR DEPOIS!
  // Getting the private key from the corresponding file
  pkey.open("../Proj/Keys/election_secret_key.txt", ios::binary);
  SecretKey election_secret_key;
  election_secret_key.load(context, pkey);
  pkey.close();
  // APAGAR DEPOIS!

  // Setting the encryption process
  Encryptor encryptor(context, election_public_key);
  Decryptor decryptor(context, election_secret_key); // APAGAR DEPOIS
  string f = "ecrypted_voter_weights";
  string txt = ".txt";
  string a;
  string forcabruta = "sudo cp ";
  string forcamenos;
  string dest = " ../Proj/Keys";
  string xau = "sudo rm -r ";
  string ciao;
  BatchEncoder batch_encoder(context);
  Plaintext plainvector;
  Ciphertext encrypted_weight;

  size_t slot_count = batch_encoder.slot_count();
  size_t row_size = slot_count / 2;
  cout << "Plaintext matrix row size: " << row_size << endl;

  vector<uint64_t> pod_matrix(slot_count, 0ULL);

  for(int i=0; i < nvoters; i = i + 1){
    pod_matrix[i] = (uint64_t) weights[i];
  }

  batch_encoder.encode(pod_matrix, plainvector);

  Ciphertext encrypted_matrix;
  encryptor.encrypt(plainvector, encrypted_matrix);

  Plaintext plain_result;
  decryptor.decrypt(encrypted_matrix, plain_result);
  vector<uint64_t> pod_result;
  batch_encoder.decode(plain_result, pod_result);

  print_matrix(pod_result, row_size);

  for(int i=0; i < nvoters; i = i + 1){
    bananas[i] = (int)pod_result[i];
    cout << bananas[i] << "\n";
  }
